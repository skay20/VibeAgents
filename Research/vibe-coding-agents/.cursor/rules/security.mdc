---
description: Security Guidelines
globs: "**/*"
alwaysApply: true
---

# Security Guidelines

## Secrets Management

NEVER commit:
- Passwords
- API keys
- Access tokens
- Private certificates
- Connection strings with credentials

### Correct Approach

```typescript
// ✅ CORRECT: Use environment variables
const apiKey = process.env.API_KEY;

// ❌ INCORRECT: Hardcoded secret
const apiKey = 'sk-live-1234567890';
```

## Input Validation

Always validate and sanitize input:

```typescript
import { z } from 'zod';

const userSchema = z.object({
  email: z.string().email(),
  name: z.string().min(2).max(100),
  age: z.number().int().min(0).max(150),
});

const validated = userSchema.parse(req.body);
```

## SQL Injection Prevention

Use parameterized queries:

```typescript
// ✅ CORRECT
const result = await db.query(
  'SELECT * FROM users WHERE id = $1',
  [userId]
);

// ❌ INCORRECT - VULNERABLE
const result = await db.query(
  `SELECT * FROM users WHERE id = ${userId}`
);
```

## Error Handling

Don't expose sensitive information in errors:

```typescript
// ✅ CORRECT
try {
  const user = await userService.findById(id);
} catch (error) {
  logger.error('Database error', error); // Log details internally
  return res.status(500).json({ 
    error: 'Internal server error' // Generic message to client
  });
}

// ❌ INCORRECT - Leaks information
catch (error) {
  return res.status(500).json({ error: error.message });
}
```

## OWASP Top 10 Checklist

- [ ] Injection attacks prevented
- [ ] Authentication secure
- [ ] Sensitive data encrypted
- [ ] XML external entities disabled
- [ ] Access control enforced
- [ ] Security misconfigurations avoided
- [ ] XSS prevented
- [ ] Insecure deserialization avoided
- [ ] Vulnerable components updated
- [ ] Logging and monitoring enabled
